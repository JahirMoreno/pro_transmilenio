-- MariaDB 10.1

CREATE DATABASE transmilenio;

USE transmilenio;

-- Creación de las tablas

CREATE TABLE HORARIO(
	id INT AUTO_INCREMENT NOT NULL,
	fecha  DATE NOT NULL,
	hora_inicio TIME NOT NULL,
	hora_fin TIME NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE RUTA(
	id INT NOT NULL AUTO_INCREMENT,
	nombre  VARCHAR(50) NOT NULL,
	estado VARCHAR(25) NOT NULL,
	longitud INT(15) NOT NULL,
	tipo_servicio VARCHAR(20) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE TIPO_BUS(
	id INT NOT NULL AUTO_INCREMENT,
	nombre  VARCHAR(20) NOT NULL,
	capacidad INT(3) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE RUTA_HORARIO(
	id_horario INT NOT NULL,
	id_ruta INT NOT NULL
)ENGINE=INNODB;

CREATE TABLE RUTA_TIPO_BUS(
	id_ruta INT NOT NULL,
	id_tipo_bus INT NOT NULL
)ENGINE=INNODB;

CREATE TABLE PARADAS_RUTAS(
	id INT NOT NULL AUTO_INCREMENT,
	id_ruta INT NOT NULL,
	id_vagon INT NOT NULL,
	nombre  VARCHAR(40) NOT NULL,
	posicion_x VARCHAR(20) NOT NULL,
	posicion_y VARCHAR(20) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE PORTAL(
	id INT NOT NULL AUTO_INCREMENT,
	nombre  VARCHAR(45) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE PLATAFORMA(
	id INT NOT NULL AUTO_INCREMENT,
	id_portal INT NOT NULL,
	nombre  VARCHAR(45) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE ESTACION(
	id INT NOT NULL AUTO_INCREMENT,
	id_portal INT NOT NULL,
	id_troncal INT NOT NULL,
	nombre  VARCHAR(45) NOT NULL,
	longitud VARCHAR(14) NOT NULL,
	latitud VARCHAR(14) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE VAGON(
	id INT NOT NULL AUTO_INCREMENT,
	id_estacion INT NOT NULL,
	nombre  VARCHAR(30) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE TRONCAL(
	id INT NOT NULL AUTO_INCREMENT,
	nombre  VARCHAR(45) NOT NULL,
	tipo_servicio VARCHAR(45) NOT NULL,
	origen VARCHAR(45) NOT NULL,
	destino VARCHAR(45) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

CREATE TABLE EMPRESA_OPERADORA(
	id INT AUTO_INCREMENT NOT NULL,
	id_estacion INT NOT NULL,
	nombre  VARCHAR(20) NOT NULL,
	PRIMARY KEY(id)
)ENGINE=INNODB;

ALTER TABLE RUTA_HORARIO ADD(
	CONSTRAINT RUH_FK_IDR FOREIGN KEY (ID_RUTA) REFERENCES RUTA(ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT RUH_FK_IDH FOREIGN KEY (ID_HORARIO) REFERENCES HORARIO(ID) ON DELETE CASCADE ON UPDATE CASCADE
);

ALTER TABLE PARADAS_RUTAS ADD(
	CONSTRAINT PAR_FK_IDR FOREIGN KEY (ID_RUTA) REFERENCES RUTA(ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT PAR_FK_IDV FOREIGN KEY (ID_VAGON) REFERENCES VAGON(ID) ON DELETE CASCADE ON UPDATE CASCADE
);

ALTER TABLE PLATAFORMA ADD(
	CONSTRAINT PLA_FK_IDP FOREIGN KEY (ID_PORTAL) REFERENCES PORTAL(ID) ON DELETE CASCADE ON UPDATE CASCADE
);

ALTER TABLE ESTACION ADD(
	CONSTRAINT EST_FK_IDP FOREIGN KEY (ID_PORTAL) REFERENCES PORTAL(ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT EST_FK_IDT FOREIGN KEY (ID_TRONCAL) REFERENCES TRONCAL(ID) ON DELETE CASCADE ON UPDATE CASCADE
);

ALTER TABLE VAGON ADD(
	CONSTRAINT VAG_FK_IDE FOREIGN KEY (ID_ESTACION) REFERENCES ESTACION(ID) ON DELETE CASCADE ON UPDATE CASCADE
);

ALTER TABLE EMPRESA_OPERADORA ADD(
	CONSTRAINT EMP_FK_IDE FOREIGN KEY (ID_ESTACION) REFERENCES ESTACION(ID) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO TIPO_BUS (NOMBRE, CAPACIDAD) VALUES('ARTICULADO',160);
INSERT INTO TIPO_BUS (NOMBRE, CAPACIDAD) VALUES('BIARTICULADO',270);
INSERT INTO TIPO_BUS (NOMBRE, CAPACIDAD) VALUES('ALIMENTADOR',90);
INSERT INTO TIPO_BUS (NOMBRE, CAPACIDAD) VALUES('ARTICULADO',160);

INSERT INTO TRONCAL (NOMBRE, TIPO_SERVICIO, ORIGEN, DESTINO) VALUES('A CARACAS','TRONCAL','HEROES','TERCER MILENIO');
INSERT INTO TRONCAL (NOMBRE, TIPO_SERVICIO, ORIGEN, DESTINO) VALUES('B AUTONORTE','TRONCAL','TERMINAL','HEROES');
INSERT INTO TRONCAL (NOMBRE, TIPO_SERVICIO, ORIGEN, DESTINO) VALUES('C SUBA','DUAL','PORTAL SUBA','ESCUELA MILITAR');
INSERT INTO TRONCAL (NOMBRE, TIPO_SERVICIO, ORIGEN, DESTINO) VALUES('D CL 80','ALIMENTADOR','PORTAL 80','POLO');

INSERT INTO RUTA (NOMBRE, ESTADO, LONGITUD, TIPO_SERVICIO) VALUES('Portal Eldorado - Universidades ','COMPLEMENTARIA',3.234567,'NOCTURNO');
INSERT INTO RUTA (NOMBRE, ESTADO, LONGITUD, TIPO_SERVICIO) VALUES('Universidades - Portal Eldorado','URBANA',5.6542456,'DIURNO');
INSERT INTO RUTA (NOMBRE, ESTADO, LONGITUD, TIPO_SERVICIO) VALUES('Portal 20 de Julio - Museo Nacional','ALIMENTADOR',15.464678,'DIURNO_PICO');
INSERT INTO RUTA (NOMBRE, ESTADO, LONGITUD, TIPO_SERVICIO) VALUES('Museo Nacional - Portal 20 de Julio ','COMPLEMENTARIA',13.565433,'DIURNO_PICO_AM');

INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL NORTE');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL SUBA');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL 80');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL EL DORADO');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL SUR');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL AMERICAS');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL 20 DE JULIO');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL USME');
INSERT INTO PORTAL (NOMBRE) VALUES('PORTAL TUNAL');

INSERT INTO ESTACION (ID_PORTAL, ID_TRONCAL, NOMBRE, LONGITUD, LATITUD) VALUES(1,1,'LA DESPENSA',-74.1876524311,4.594799604705);
INSERT INTO ESTACION (ID_PORTAL, ID_TRONCAL, NOMBRE, LONGITUD, LATITUD) VALUES(4,4,'BOSA',-74.1815740859,4.596794911120);
INSERT INTO ESTACION (ID_PORTAL, ID_TRONCAL, NOMBRE, LONGITUD, LATITUD) VALUES(2,3,'LEON XIII',-74.1936665202,4.591904305313);
INSERT INTO ESTACION (ID_PORTAL, ID_TRONCAL, NOMBRE, LONGITUD, LATITUD) VALUES(3,2,'TERRERO-HOSPITAL CV',-74.1994982118,4.588953794143);

INSERT INTO PLATAFORMA (ID_PORTAL, NOMBRE) VALUES(5,'PLATAFORMA NORTE');
INSERT INTO PLATAFORMA (ID_PORTAL, NOMBRE) VALUES(2,'PLATAFORMA SUR');
INSERT INTO PLATAFORMA (ID_PORTAL, NOMBRE) VALUES(7,'PLATAFORMA 1');
INSERT INTO PLATAFORMA (ID_PORTAL, NOMBRE) VALUES(8,'PLATAFORMA 2');
INSERT INTO PLATAFORMA (ID_PORTAL, NOMBRE) VALUES(4,'PLATAFORMA 3');

INSERT INTO VAGON (ID_ESTACION, NOMBRE) VALUES(2,'VAGON 1');
INSERT INTO VAGON (ID_ESTACION, NOMBRE) VALUES(1,'VAGON 2');
INSERT INTO VAGON (ID_ESTACION, NOMBRE) VALUES(4,'VAGON 3');
INSERT INTO VAGON (ID_ESTACION, NOMBRE) VALUES(3,'VAGON 4');

INSERT INTO PARADAS_RUTAS (ID_RUTA, ID_VAGON, NOMBRE, POSICION_X, POSICION_Y) VALUES(1,1,'001A01 - Br. Rincón del Chicó ',23.456544,12.3455433);
INSERT INTO PARADAS_RUTAS (ID_RUTA, ID_VAGON, NOMBRE, POSICION_X, POSICION_Y) VALUES(3,4,'093B02 - Br. Estoril ',23.345432,12.234567);
INSERT INTO PARADAS_RUTAS (ID_RUTA, ID_VAGON, NOMBRE, POSICION_X, POSICION_Y) VALUES(2,3,'160A01 - Escuela de Infantería',23.345432,12.234567);
INSERT INTO PARADAS_RUTAS (ID_RUTA, ID_VAGON, NOMBRE, POSICION_X, POSICION_Y) VALUES(4,4,'122A01 - Autopista Norte',23.356743343,12.35890876543);

INSERT INTO HORARIO (FECHA, HORA_INICIO, HORA_FIN) VALUES('2019/02/12','05:00:00','23:00:00');
INSERT INTO HORARIO (FECHA, HORA_INICIO, HORA_FIN) VALUES('2019/02/13','04:00:00','23:00:00');
INSERT INTO HORARIO (FECHA, HORA_INICIO, HORA_FIN) VALUES('2019/06/15','06:00:00','22:00:00');
INSERT INTO HORARIO (FECHA, HORA_INICIO, HORA_FIN) VALUES('2019/05/16','05:00:00','23:00:00');

INSERT INTO EMPRESA_OPERADORA (ID_ESTACION, NOMBRE) VALUES(2,'Ciudad Móvil S.A');
INSERT INTO EMPRESA_OPERADORA (ID_ESTACION, NOMBRE) VALUES(1,'Transmasivo S.A');
INSERT INTO EMPRESA_OPERADORA (ID_ESTACION, NOMBRE) VALUES(3,'Citimóvil');
INSERT INTO EMPRESA_OPERADORA (ID_ESTACION, NOMBRE) VALUES(2,'Coobus S.A.S ');

INSERT INTO RUTA_TIPO_BUS (ID_RUTA, ID_TIPO_BUS) VALUES(2,4);
INSERT INTO RUTA_TIPO_BUS (ID_RUTA, ID_TIPO_BUS) VALUES(1,3);
INSERT INTO RUTA_TIPO_BUS (ID_RUTA, ID_TIPO_BUS) VALUES(3,1);
INSERT INTO RUTA_TIPO_BUS (ID_RUTA, ID_TIPO_BUS) VALUES(4,2);

INSERT INTO RUTA_HORARIO (ID_HORARIO, ID_RUTA) VALUES(1,4);
INSERT INTO RUTA_HORARIO (ID_HORARIO, ID_RUTA) VALUES(3,4);
INSERT INTO RUTA_HORARIO (ID_HORARIO, ID_RUTA) VALUES(2,1);
INSERT INTO RUTA_HORARIO (ID_HORARIO, ID_RUTA) VALUES(3,2);



